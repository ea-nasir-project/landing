---
import { Image } from "astro:assets";
import Label from "./BlogLabel.astro";
import type { Author } from "@/data/authors";
import { authors } from "@/data/authors";
import type { Category } from "@/data/category";
import { categories } from "@/data/category";
import { getFormattedDate } from "@/utils/date";
import { Icon } from "astro-icon/components";

const { post, aspect, preloadImage } = Astro.props;
const author = authors.find((item) => item.slug === post.data.author) as Author;
const category = categories.find(
  (item) => item.slug === post.data.category,
) as Category;

// Fallback for author and category if not found
const safeAuthor = author || authors[0];
const safeCategory = category || categories[0];

const categoryColors = {
  green: {
    text: "text-emerald-900",
    underline:
      "bg-linear-to-r from-emerald-200 to-emerald-100",
  },
  blue: {
    text: "text-blue-900",
    underline:
      "bg-linear-to-r from-blue-200 to-blue-100",
  },
  yellow: {
    text: "text-yellow-900",
    underline:
      "bg-linear-to-r from-yellow-200 to-yellow-100",
  },
  purple: {
    text: "text-purple-900",
    underline:
      "bg-linear-to-r from-purple-200 to-purple-100",
  },
};

const activeCategoryColor =
  categoryColors[safeCategory.color as keyof typeof categoryColors] ||
  categoryColors.green;
---

<div class="cursor-pointer group">
  <div
    class:list={[
      "relative overflow-hidden transition-all bg-gray-100 rounded-md hover:scale-105",
      aspect === "landscape" ? "aspect-video" : "aspect-square",
    ]}
  >
    <a href={"/blog/" + post.id}>
      {
        post.data.heroImage ? (
          <Image
            src={post.data.heroImage}
            width={800}
            height={aspect === "landscape" ? 450 : 800}
            alt={post.data.title}
            loading={preloadImage ? "eager" : "lazy"}
            class="w-full h-full object-cover rounded-md"
          />
        ) : (
          <span class="absolute w-16 h-16 text-gray-200 -translate-x-1/2 -translate-y-1/2 top-1/2 left-1/2">
            <Icon class="w-4 h-4 text-black" name="tabler:photo" />
          </span>
        )
      }
    </a>
  </div>

  <div class="mt-2">
    <a href="#">
      <Label theme={safeCategory.color}>{safeCategory.title}</Label>
    </a>
  </div>
  <h2
    class:list={[
      "mt-2 text-lg font-semibold tracking-normal transition-colors",
      activeCategoryColor.text,
    ]}
  >
    <a href={"/blog/" + post.id}>
      <span
        class:list={[
          "bg-bottom-left bg-no-repeat transition-[background-size] duration-500 hover:bg-size-[100%_3px] group-hover:bg-size-[100%_10px] bg-size-[0px_10px]",
          activeCategoryColor.underline,
        ]}
      >
        {post.data.title}
      </span>
    </a>
  </h2>

  <div class="hidden">
    {
      post.data.description && (
        <p class="mt-2 text-sm text-gray-500 line-clamp-3">
          <a href={"/blog/" + post.id}>{post.data.description}</a>
        </p>
      )
    }
  </div>

  <div
    class="flex items-center mt-3 space-x-3 text-gray-500"
  >
    <div class="flex items-center gap-3">
      <div class="relative shrink-0 w-5 h-5">
        {
          safeAuthor.image && (
            <Image
              src={safeAuthor.image}
              alt="Author Photo"
              width={40}
              height={40}
              loading="lazy"
              class="rounded-full w-full h-full object-cover"
            />
          )
        }
      </div>
      <span class="text-sm">{safeAuthor.name}</span>
    </div>
    <span class="text-xs text-gray-300"> &bull;</span>
    <time class="text-sm" datetime={post.data.pubDate.toISOString()}>
      {getFormattedDate(post.data.pubDate)}
    </time>
  </div>
</div>
